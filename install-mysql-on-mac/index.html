<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 在Mac下安装MySQL · ScienJus's Blog</title><meta name="description" content="在Mac下安装MySQL - ScienJus"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.scienjus.com/atom.xml" title="ScienJus's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/ScienJus" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/ScienJus" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">在Mac下安装MySQL</h1><div class="post-info">Sep 3, 2015</div><div class="post-content"><p>最近开始将开发工具都转移到 Mac 上了，其中也会莫名其妙的遇到一些坑，不如干脆将整个流程都记录下来，方便以后查找。</p>
<h3 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h3><p> 首先进入 <a href="http://www.mysql.com/downloads/" target="_blank" rel="external">MySQL 官网</a>，选择免费的<code>Community</code>版：<code>MySQL Community Server</code>。MySQL 官网提供了<code>tar.gz</code>和<code>dmg</code>两种格式的安装包，接下来主要围绕使用<code>dmg</code>安装来说。</p>
<p><img src="/uploads/2015/09/download.jpg" alt="download"></p>
<p> 下载后双击打开安装包，根据说明一步步确认即可完成安装。安装成功后打开系统偏好设置，在最下面可以找到 MySQL，通过它可以查看 MySQL 状态并启动和关闭 MySQL。</p>
<p><img src="/uploads/2015/09/start.jpg" alt="start"></p>
<h3 id="指定配置"><a href="#指定配置" class="headerlink" title="指定配置"></a>指定配置</h3><p> 使用该方式启动 MySQL 时是没有指定配置文件的，因此 MySQL 会按照以下顺序载入配置文件：</p>
<ol>
<li><code>/etc/my.cnf</code></li>
<li><code>/etc/mysql/my.cnf</code></li>
<li><code>/usr/local/mysql/etc/my.cnf</code></li>
<li><p><code>~/.my.cnf</code></p>
<p>只需要创建其中一个文件并设定好配置即可。</p>
</li>
</ol>
<h3 id="mysql-command-not-found"><a href="#mysql-command-not-found" class="headerlink" title="mysql: command not found"></a>mysql: command not found</h3><p> 安装后直接在命令行输入<code>mysql</code>会提示<code>mysql: command not found</code>，需要先将其添加到环境变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p> 添加以下指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$&#123;PATH&#125;:/usr/local/mysql/bin</span><br></pre></td></tr></table></figure>
<p> 保存后立即使其生效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p> 便可以使用 MySQL 的相关命令了。</p>
<h3 id="配置用户"><a href="#配置用户" class="headerlink" title="配置用户"></a>配置用户</h3><p> 刚安装好的 MySQL 只有一个密码为空的<code>root</code>用户，首先需要给该用户设置一个密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -u root password 你的密码</span><br></pre></td></tr></table></figure>
<p> 然后使用设置好的密码登录 MySQl：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"> 输入刚才设置的密码</span><br></pre></td></tr></table></figure>
<p> 由于<code>root</code>用户只能用于本地登录，无法远程登录，所以还需要创建一个用于远程登录的用户：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL ON *.* TO 你的用户名 @&apos;%&apos; IDENTIFIED BY &apos;你的密码&apos; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>
<p> 这条语句的意思是创建一个用户，赋予它以任何方式访问，在任何数据库的所有操作权限，但是实际这里的任何访问方式其实不包括<code>localhost</code>，所以还需要单独设定：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL ON *.* TO 你的用户名 @localhost IDENTIFIED BY &apos;你的密码&apos; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>
<p> 与上一条语句一样，只是将任何访问方式改为了以<code>localhost</code>访问。</p>
<h3 id="ERROR-2003-HY000-Can’t-connect-to-MySQL-server-on-‘127-0-0-1’-61"><a href="#ERROR-2003-HY000-Can’t-connect-to-MySQL-server-on-‘127-0-0-1’-61" class="headerlink" title="ERROR 2003 (HY000): Can’t connect to MySQL server on ‘127.0.0.1’ (61)"></a>ERROR 2003 (HY000): Can’t connect to MySQL server on ‘127.0.0.1’ (61)</h3><p> 配置完远程登录的账户后，尝试使用该账户登录一下 MySQL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -h localhost -u 你的用户名 -p</span><br><span class="line"> 输入密码</span><br></pre></td></tr></table></figure>
<p> 确实是可以登录成功的，可是如果使用 ip 登录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 127.0.0.1 -u 你的用户名 -p</span><br><span class="line"> 输入密码</span><br></pre></td></tr></table></figure>
<p> 却会出现<code>ERROR 2003 (HY000): Can&#39;t connect to MySQL server on &#39;127.0.0.1&#39; (61)</code>的错误。原因是使用<code>dmg</code>安装的 MySQL 启动时的默认端口号不是<code>3306</code>而是<code>3307</code>，可以在这里修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano com.oracle.oss.mysql.mysqld.plist</span><br></pre></td></tr></table></figure>
<p> 将<code>--port</code>的值改为<code>3306</code>即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version=&quot;1.0&quot;&gt;</span><br><span class="line">  &lt;dict&gt;</span><br><span class="line">    &lt;key&gt;Label&lt;/key&gt; &lt;string&gt;com.oracle.oss.mysql.mysqld&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;ProcessType&lt;/key&gt; &lt;string&gt;Interactive&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;Disabled&lt;/key&gt; &lt;false/&gt;</span><br><span class="line">    &lt;key&gt;RunAtLoad&lt;/key&gt; &lt;true/&gt;</span><br><span class="line">    &lt;key&gt;KeepAlive&lt;/key&gt; &lt;true/&gt;</span><br><span class="line">    &lt;key&gt;SessionCreate&lt;/key&gt; &lt;true/&gt;</span><br><span class="line">    &lt;key&gt;LaunchOnlyOnce&lt;/key&gt; &lt;false/&gt;</span><br><span class="line">    &lt;key&gt;UserName&lt;/key&gt; &lt;string&gt;_mysql&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;GroupName&lt;/key&gt; &lt;string&gt;_mysql&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;ExitTimeOut&lt;/key&gt; &lt;integer&gt;600&lt;/integer&gt;</span><br><span class="line">    &lt;key&gt;Program&lt;/key&gt; &lt;string&gt;/usr/local/mysql/bin/mysqld&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;ProgramArguments&lt;/key&gt;</span><br><span class="line">    &lt;array&gt;</span><br><span class="line">      &lt;string&gt;/usr/local/mysql/bin/mysqld&lt;/string&gt;</span><br><span class="line">      &lt;string&gt;--user=_mysql&lt;/string&gt;</span><br><span class="line">      &lt;string&gt;--basedir=/usr/local/mysql&lt;/string&gt;</span><br><span class="line">      &lt;string&gt;--datadir=/usr/local/mysql/data&lt;/string&gt;</span><br><span class="line">      &lt;string&gt;--plugin-dir=/usr/local/mysql/lib/plugin&lt;/string&gt;</span><br><span class="line">      &lt;string&gt;--log-error=/usr/local/mysql/data/mysqld.local.err&lt;/string&gt;</span><br><span class="line">      &lt;string&gt;--pid-file=/usr/local/mysql/data/mysqld.local.pid&lt;/string&gt;</span><br><span class="line">      &lt;string&gt;--port=3307&lt;/string&gt;</span><br><span class="line">    &lt;/array&gt;</span><br><span class="line">    &lt;key&gt;WorkingDirectory&lt;/key&gt; &lt;string&gt;/usr/local/mysql&lt;/string&gt;</span><br><span class="line">  &lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure>
<p> 或是直接指定端口号连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 127.0.0.1 -P 3307 -u 你的用户名 -p</span><br><span class="line"> 输入密码</span><br></pre></td></tr></table></figure>
<h3 id="Communications-link-failure"><a href="#Communications-link-failure" class="headerlink" title="Communications link failure"></a>Communications link failure</h3><p>Out of resources when opening file ‘…’</p>
<p> 这两个都是 JDBC 连接 MySQL 时报的错，之所以放在一起说是因为改着改着莫名其妙两个都好了。</p>
<p> 配好 MySQL 项目后运行了一个多数据源并使用数据库连接池的项目，一共有 32 个数据源，tomcat-jdbc 连接池每个数据源初始化 10 个连接，在创建一半数据源之后开始出现第一个错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</span><br><span class="line"></span><br><span class="line">The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.</span><br></pre></td></tr></table></figure>
<p> 很多种情况都会导致这个错误，不过这里应该是数据库连接数不够，想到配置完后几乎没有编辑<code>my.cnf</code>文件，于是添加了这些属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">max_connect_errors = 10000</span><br><span class="line">max_connections=10000</span><br><span class="line">max_user_connections=10000</span><br></pre></td></tr></table></figure>
<p> 修改完后使用<code>show variables like &#39;max%&#39;;</code>查看数据库属性，发现对应数值确实改变了，但是运行程序还是会出现一样的问题。</p>
<p> 后来也 google 了很久，推测应该是系统配置导致的限制，但是也没找到问题具体出在哪里，只好先把初始化的线程数改小看看能不能正常运行，结果程序运行了一段时间后又出现另一个错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Out of resources when opening file &apos;./xxx.MYD&apos; (Errcode: 24)</span><br></pre></td></tr></table></figure>
<p> 这个错误的原因就很显而易见了，肯定是 MySQL 打开的文件过多了，但是我明明记得在<code>my.cnf</code>中设置了<code>open_files_limit</code>，不可能出现这个错误啊。</p>
<p> 结果使用<code>show variables like &#39;open%&#39;;</code>一看，配置竟然没生效，文件数只有可怜的 256，再三确认配置没有问题后认定原因肯定出在系统配置上。</p>
<p> 首先使用<code>ulimit -n</code>查看系统的文件数限制，果然是 256，看来 MySQL 会在<code>my.cnf</code>和<code>ulimit</code>中选择较小的一方作为真正的值。</p>
<p> 然后 google 一下 Mac 如何修改这个数值，一种方式是使用<code>launchctl limit maxfiles 65535</code>将文件数修改成 65535，尝试后发现确实系统的<code>ulimit -n</code>和 MySQL 的<code>open_files_limit</code>都变成了 65535。当时以为这样就解决了，结果又发现 JDBC 无法连接 MySQL 了，而 MySQL 客户端就能连上，真是匪夷所思。还好这个配置只要重启电脑就会失效，重启过后又能正常的连上 MySQL 了。</p>
<p> 还有一种方法只能用在 Mac OS X Yosemite 上的，首先创建<code>/Library/LaunchDaemons/limit.maxfiles.plist</code>文件，添加以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version=&quot;1.0&quot;&gt;</span><br><span class="line">  &lt;dict&gt;</span><br><span class="line">    &lt;key&gt;Label&lt;/key&gt;</span><br><span class="line">      &lt;string&gt;limit.maxfiles&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;ProgramArguments&lt;/key&gt;</span><br><span class="line">      &lt;array&gt;</span><br><span class="line">        &lt;string&gt;launchctl&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;limit&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;maxfiles&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;65536&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;65536&lt;/string&gt;</span><br><span class="line">      &lt;/array&gt;</span><br><span class="line">    &lt;key&gt;RunAtLoad&lt;/key&gt;</span><br><span class="line">      &lt;true/&gt;</span><br><span class="line">    &lt;key&gt;ServiceIPC&lt;/key&gt;</span><br><span class="line">      &lt;false/&gt;</span><br><span class="line">  &lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure>
<p> 创建<code>/Library/LaunchDaemons/limit.maxproc.plist</code>文件，添加以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple/DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version=&quot;1.0&quot;&gt;</span><br><span class="line">  &lt;dict&gt;</span><br><span class="line">    &lt;key&gt;Label&lt;/key&gt;</span><br><span class="line">      &lt;string&gt;limit.maxproc&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;ProgramArguments&lt;/key&gt;</span><br><span class="line">      &lt;array&gt;</span><br><span class="line">        &lt;string&gt;launchctl&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;limit&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;maxproc&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;2048&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;2048&lt;/string&gt;</span><br><span class="line">      &lt;/array&gt;</span><br><span class="line">    &lt;key&gt;RunAtLoad&lt;/key&gt;</span><br><span class="line">      &lt;true /&gt;</span><br><span class="line">    &lt;key&gt;ServiceIPC&lt;/key&gt;</span><br><span class="line">      &lt;false /&gt;</span><br><span class="line">  &lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure>
<p> 然后重启电脑就会发现数值已经改变了，所有方式也都能正常连接，我把初始化线程数调回来以后发现第一个错误也不会出现了。</p>
</div></article></div></main><footer><div class="paginator"><a href="/centos65-java-web-production-environment/" class="prev">PREV</a><a href="/method-parameters/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'scienjus';
var disqus_identifier = 'install-mysql-on-mac/';
var disqus_title = '在Mac下安装MySQL';
var disqus_url = 'http://www.scienjus.com/install-mysql-on-mac/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//scienjus.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2019 <a href="http://www.scienjus.com">ScienJus</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?47cf199e59a26235dadf455975b8b67f";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();</script></body></html>